<?xml version="1.0" encoding="utf-8"?>
<gpu:xmodel>
  <name>Optional </name>
  <gpu:environment>
    <gpu:constants>
	  <gpu:variable>
		  <type>short</type>
		  <name>FLOOD_DATA_ARRAY</name>
		  <description>none</description>
		  <arrayLength>900000</arrayLength>
	  </gpu:variable>
	  <gpu:variable>
		  <type>int</type>
		  <name>TIME</name>
		  <description>none</description>
	  </gpu:variable>
      <gpu:variable>
		  <type>int</type>
		  <name>RANDOM_SEED_SEC</name>
		  <description>none</description>
	  </gpu:variable>
	  <gpu:variable>
		  <type>int</type>
		  <name>RANDOM_SEED_MIN</name>
		  <description>none</description>
	  </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>TIME_SCALER</name>
      </gpu:variable>
    </gpu:constants>
    <gpu:functionFiles>
      <file>functions.c</file>
    </gpu:functionFiles>
	<gpu:initFunctions>
		<gpu:initFunction>
			<gpu:name>initConstants</gpu:name>
		</gpu:initFunction>
	</gpu:initFunctions>
	<gpu:stepFunctions>
		<gpu:stepFunction>
			<gpu:name>read_data_func</gpu:name>
		</gpu:stepFunction>
	</gpu:stepFunctions>
  </gpu:environment>
  <xagents>
    <gpu:xagent>
      <name>household</name>
      <memory>
        <gpu:variable>
          <type>float</type>
          <name>x</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>y</name>
        </gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>resident_num</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>OYI</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>tenure</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>take_measure</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>warning_area</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>get_warning</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>alert_state</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>sandbag_state</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>sandbag_time_count</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>flooded_time</name>
		</gpu:variable>
		<gpu:variable>
		  <type>float</type>
		  <name>initial_wl</name>
		</gpu:variable>
		<gpu:variable>
		  <type>float</type>
		  <name>actual_wl</name>
		</gpu:variable>
		<gpu:variable>
		  <type>float</type>
		  <name>average_wl</name>
		</gpu:variable>
		<gpu:variable>
		  <type>float</type>
		  <name>max_wl</name>
		</gpu:variable>
		<gpu:variable>
		  <type>float</type>
		  <name>financial_damage</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>inform_others</name>
		</gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>get_informed</name>
		</gpu:variable>
        <!-- rendering and animation variables-->
        <gpu:variable>
          <type>int</type>
          <name>lod</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>animate</name>
        </gpu:variable>
        <gpu:variable>
          <type>int</type>
          <name>animate_dir</name>
        </gpu:variable>
      </memory>
      <functions>
		<gpu:function>
		    <name>output_financial_damage_infor</name>
			<currentState>default</currentState>
			<nextState>default</nextState>
			<outputs>
				<gpu:output>
					<messageName>financial_damage_infor</messageName>
					<gpu:type>single_message</gpu:type>
				</gpu:output>
			</outputs>
			<gpu:reallocate>false</gpu:reallocate>
			<gpu:RNG>false</gpu:RNG>
		</gpu:function>
		<gpu:function>
			  <name>identify_flood</name>
			  <currentState>default</currentState>
			  <nextState>default</nextState>
			  <inputs>
				  <gpu:input>
					  <messageName>flood_cell</messageName>
				  </gpu:input>
			  </inputs>
			  <gpu:reallocate>true</gpu:reallocate>
			  <gpu:RNG>true</gpu:RNG>
		</gpu:function>
		<gpu:function>
			<name>detect_flood</name>
			<currentState>default</currentState>
			<nextState>default</nextState>
			<inputs>
				<gpu:input>
					<messageName>flood_cell</messageName>
				</gpu:input>
			</inputs>
			<gpu:reallocate>true</gpu:reallocate>
			<gpu:RNG>true</gpu:RNG>
		</gpu:function>
		<gpu:function>
          <name>communicate</name>
          <currentState>default</currentState>
          <nextState>default</nextState>
          <inputs>
            <gpu:input>
              <messageName>state_data</messageName>
            </gpu:input>
          </inputs>
          <gpu:reallocate>false</gpu:reallocate>
          <gpu:RNG>true</gpu:RNG>
        </gpu:function>
      </functions>
      <states>
        <gpu:state>
          <name>default</name>
        </gpu:state>
        <initialState>default</initialState>
      </states>
      <gpu:type>continuous</gpu:type>
      <gpu:bufferSize>1048576</gpu:bufferSize>
    </gpu:xagent>
    <gpu:xagent>
      <name>flood</name>
      <memory>
        <gpu:variable>
          <type>int</type>
          <name>x</name>
        </gpu:variable>
        <gpu:variable>
          <type>int</type>
          <name>y</name>
        </gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>floodID</name>
		</gpu:variable>
		<gpu:variable>
	      <type>float</type>
		  <name>flood_h</name>
		</gpu:variable>
      </memory>
      <functions>
        <gpu:function>
          <name>output_flood_cells</name>
          <currentState>static</currentState>
          <nextState>static</nextState>
          <outputs>
            <gpu:output>
              <messageName>flood_cell</messageName>
              <gpu:type>single_message</gpu:type>
            </gpu:output>
          </outputs>
          <gpu:reallocate>false</gpu:reallocate>
          <gpu:RNG>false</gpu:RNG>
        </gpu:function>	
		<gpu:function>
			<name>generate_warnings</name>
			<currentState>static</currentState>
			<nextState>static</nextState>
			<xagentOutputs>
				<gpu:xagentOutput>
					<xagentName>warning</xagentName>
					<state>static_warning</state>
				</gpu:xagentOutput>
			</xagentOutputs>
			<gpu:reallocate>false</gpu:reallocate>
			<gpu:RNG>false</gpu:RNG>
		</gpu:function>
		<gpu:function>
			<name>update_data</name>
			<currentState>static</currentState>
			<nextState>static</nextState>
			<gpu:reallocate>false</gpu:reallocate>
			<gpu:RNG>false</gpu:RNG>
		</gpu:function>
	  </functions>
      <states>
        <gpu:state>
          <name>static</name>
        </gpu:state>
        <initialState>static</initialState>
      </states>
      <gpu:type>discrete</gpu:type>
      <gpu:bufferSize>1048576</gpu:bufferSize>
    </gpu:xagent>
	<gpu:xagent>
		<name>warning</name>
		<memory>
			<gpu:variable>
				<type>float</type>
				<name>x</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>y</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>flooded_households</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>total_financial_damage</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_take_measure</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_get_warning</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_alert_state</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_sandbag1</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_sandbag2</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_sandbag3</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_inform_others</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_get_informed</name>
			</gpu:variable>
		</memory>
		<functions>
			<gpu:function>
				<name>calcu_damage_infor</name>
				<currentState>static_warning</currentState>
				<nextState>static_warning</nextState>
				<inputs>
					<gpu:input>
						<messageName>financial_damage_infor</messageName>
					</gpu:input>
				</inputs>
				<gpu:reallocate>false</gpu:reallocate>
				<gpu:RNG>false</gpu:RNG>
			</gpu:function>
			<gpu:function>
				<name>output_state_data</name>
				<currentState>static_warning</currentState>
				<nextState>static_warning</nextState>
				<outputs>
					<gpu:output>
						<messageName>state_data</messageName>
						<gpu:type>single_message</gpu:type>
					</gpu:output>
				</outputs>
				<gpu:reallocate>false</gpu:reallocate>
				<gpu:RNG>false</gpu:RNG>
			</gpu:function>
		</functions>
		<states>
			<gpu:state>
				<name>static_warning</name>
			</gpu:state>
			<initialState>static_warning</initialState>
		</states>
		<gpu:type>continuous</gpu:type>
		<gpu:bufferSize>1048576</gpu:bufferSize>
	</gpu:xagent>
  </xagents>
  <messages>
    <gpu:message>
      <name>flood_cell</name>
      <variables>
        <gpu:variable>
          <type>int</type>
          <name>x</name>
        </gpu:variable>
        <gpu:variable>
          <type>int</type>
          <name>y</name>
        </gpu:variable>
		<gpu:variable>
		  <type>int</type>
		  <name>floodID</name>
		</gpu:variable>
		<gpu:variable>
		  <type>float</type>
		  <name>flood_h</name>
		</gpu:variable>
      </variables>
      <gpu:partitioningDiscrete>
        <gpu:radius>0</gpu:radius>
      </gpu:partitioningDiscrete>
      <gpu:bufferSize>1048576</gpu:bufferSize>
    </gpu:message>
	<gpu:message>
		<name>financial_damage_infor</name>
		<variables>
			<gpu:variable>
				<type>float</type>
				<name>x</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>y</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>z</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>max_wl</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>financial_damage</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>take_measure</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>get_warning</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>alert_state</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>sandbag_state</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>inform_others</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>get_informed</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>flooded_time</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>actual_wl</name>
			</gpu:variable>
		</variables>
		<gpu:partitioningNone/>
		<gpu:bufferSize>1048576</gpu:bufferSize>
	</gpu:message>
	<gpu:message>
		<name>state_data</name>
		<variables>
			<gpu:variable>
				<type>float</type>
				<name>x</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>y</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>flooded_households</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>total_financial_damage</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_take_measure</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_get_warning</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_alert_state</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_sandbag1</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_sandbag2</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_sandbag3</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_inform_others</name>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>total_get_informed</name>
			</gpu:variable>
		</variables>
		<gpu:partitioningNone/>
		<gpu:bufferSize>1048576</gpu:bufferSize>
	</gpu:message>
  </messages>
  <layers>
    <layer>
	  <gpu:layerFunction>
		<name>generate_warnings</name>
	  </gpu:layerFunction>
    </layer>
    <layer>
	  <gpu:layerFunction>
		<name>update_data</name>
	  </gpu:layerFunction>
      <gpu:layerFunction>
        <name>output_flood_cells</name>
      </gpu:layerFunction>
    </layer>
	<layer>
	  <gpu:layerFunction>
	    <name>output_financial_damage_infor</name>
	  </gpu:layerFunction>
	  <gpu:layerFunction>
	    <name>output_state_data</name>
	  </gpu:layerFunction>
	</layer>
	<layer>
	  <gpu:layerFunction>
	    <name>calcu_damage_infor</name>
	  </gpu:layerFunction>
	</layer>
	<layer>
	  <gpu:layerFunction>
		<name>identify_flood</name>
	  </gpu:layerFunction>
	  <gpu:layerFunction>
		<name>detect_flood</name>
	  </gpu:layerFunction>
      <gpu:layerFunction>
		<name>communicate</name>
	  </gpu:layerFunction>
    </layer>
  </layers>
</gpu:xmodel>
